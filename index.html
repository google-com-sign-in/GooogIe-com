<!DOCTYPE html>
import React, { useState, createContext, useContext, useEffect, useMemo, useRef } from 'react';
import { ShoppingCart, Home, Store, Info, Phone, Search, X, Moon, Sun, ChevronRight, Instagram, Facebook, Twitter, Mail, User, Heart, MessageSquare, MapPin, Pencil } from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from 'firebase/auth';
import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, query, getDocs, where, setDoc, getDoc } from 'firebase/firestore';

// Define the custom color palette
const colors = {
  primary: '#4A2C2A', // Dark chocolate brown
  secondary: '#E8E2D9', // Creamy white
  accent: '#A5776B', // Lighter brown for accents
};

const fontStyles = {
  river: { fontFamily: 'Cormorant Garamond, serif' },
  general: { fontFamily: 'Almarai, sans-serif' },
};

// IMPORTANT: The Firebase security rules have been updated directly in the code logic.
// The app will now store and retrieve products from a user-specific path,
// which is allowed by the default security rules of the Canvas environment.
// No manual rule changes are needed.

// Placeholder for Firebase configuration
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Data for initial products
const initialProducts = [
  { name: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ù‚Ù‡ÙˆØ© ÙØ§Ø®Ø±Ø©', category: 'Ù‚Ù‡ÙˆØ©', price: 99.00, image: 'https://placehold.co/400x500/F2EAE4/5C4033?text=Ù‚Ù‡ÙˆØ©', description: 'Ø£ÙØ®Ø± Ø£Ù†ÙˆØ§Ø¹ Ø­Ø¨ÙˆØ¨ Ø§Ù„Ø¨Ù† Ù…Ù† Ù…Ø²Ø§Ø±Ø¹ Ù…Ø®ØªØ§Ø±Ø© Ø­ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ØŒ Ù…Ø­Ø¶Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ… ØªØ¬Ø±Ø¨Ø© Ù„Ø§ ØªÙÙ†Ø³Ù‰.', details: 'Ù‚Ù‡ÙˆØ© Ù…Ø®ØªØµØ©ØŒ ØªØ­Ù…ÙŠØµ Ù…ØªÙˆØ³Ø·ØŒ Ø­Ø¨ÙˆØ¨ Ø£Ø±Ø§Ø¨ÙŠÙƒØ§.', isFeatured: true },
  { name: 'ØªØ´ÙƒÙŠÙ„Ø© Ø­Ù„ÙˆÙŠØ§Øª Ù…Ù†ÙˆØ¹Ø©', category: 'Ø­Ù„ÙˆÙŠØ§Øª', price: 75.50, image: 'https://placehold.co/400x500/F4D7D7/8A3E4E?text=Ø­Ù„ÙˆÙŠØ§Øª', description: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø®ØªØ§Ø±Ø© Ù…Ù† Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ© ÙˆØ§Ù„ØºØ±Ø¨ÙŠØ©ØŒ Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø£Ùˆ Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©.', details: 'ØªØ¶Ù… Ù…Ø§ÙƒØ±ÙˆÙ†ØŒ ÙƒÙˆÙƒÙŠØ²ØŒ ÙˆÙƒØ¨ ÙƒÙŠÙƒ.', isFeatured: true },
  { name: 'ÙƒÙŠÙƒ Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø§Ù„ØºÙ†ÙŠ', category: 'ÙƒÙŠÙƒ', price: 120.00, image: 'https://placehold.co/400x500/D4B8B8/553333?text=ÙƒÙŠÙƒ', description: 'ÙƒÙŠÙƒ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ØºÙ†ÙŠ Ø¨Ø§Ù„ÙƒØ±ÙŠÙ…Ø© ÙˆØ§Ù„Ø·Ø¨Ù‚Ø§ØªØŒ Ù…Ø¹ Ø·Ø¹Ù… Ø³Ø§Ø­Ø± ÙŠØ°ÙˆØ¨ ÙÙŠ Ø§Ù„ÙÙ….', details: 'Ù…ÙƒÙˆÙ†Ø§Øª Ø·Ø¨ÙŠØ¹ÙŠØ©ØŒ Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ø©.', isFeatured: true },
  { name: 'Ø¨Ø§Ù‚Ø© ÙˆØ±ÙˆØ¯ Ø£Ù†ÙŠÙ‚Ø©', category: 'Ø²Ù‡ÙˆØ±', price: 150.00, image: 'https://placehold.co/400x500/F2E4E4/8A3E4E?text=Ø²Ù‡ÙˆØ±', description: 'Ø¨Ø§Ù‚Ø© Ù…Ù† Ø£Ø¬Ù…Ù„ Ø§Ù„ÙˆØ±ÙˆØ¯ Ø§Ù„Ø·Ø§Ø²Ø¬Ø©ØŒ Ù…Ù†Ø³Ù‚Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ…Ù‡Ø§ ÙƒÙ‡Ø¯ÙŠØ© Ù…Ø«Ø§Ù„ÙŠØ©.', details: 'ÙˆØ±Ø¯ Ø¬ÙˆØ±ÙŠ Ø£Ø­Ù…Ø±ØŒ Ù„ÙŠÙ„Ùƒ Ø£Ø¨ÙŠØ¶ØŒ ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¹ ÙˆØ±Ù‚ Ø´Ø¬Ø±.', isFeatured: true },
  { name: 'Ø¹Ù„Ø¨Ø© Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¨Ù„Ø¬ÙŠÙƒÙŠØ©', category: 'Ø´ÙˆÙƒÙˆÙ„Ø§', price: 85.00, image: 'https://placehold.co/400x500/C4A8A8/553333?text=Ø´ÙˆÙƒÙˆÙ„Ø§', description: 'Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¨Ù„Ø¬ÙŠÙƒÙŠØ© ÙØ§Ø®Ø±Ø© Ø¨Ù†ÙƒÙ‡Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©ØŒ Ù…ØºÙ„ÙØ© Ø¨Ø´ÙƒÙ„ Ø£Ù†ÙŠÙ‚.', details: 'Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¯Ø§ÙƒÙ†Ø©ØŒ Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨ØŒ Ù…Ø¹ Ø­Ø´ÙˆØ§Øª Ù…Ø®ØªÙ„ÙØ©.', isFeatured: false },
  { name: 'Ù‚Ù‡ÙˆØ© Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ Ø®Ø§ØµØ©', category: 'Ù‚Ù‡ÙˆØ©', price: 80.00, image: 'https://placehold.co/400x500/F2EAE4/5C4033?text=Ù‚Ù‡ÙˆØ©+Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ', description: 'Ø­Ø¨ÙˆØ¨ Ù‚Ù‡ÙˆØ© Ù…Ø­Ù…ØµØ© Ø®ØµÙŠØµØ§Ù‹ Ù„ØªØ­Ø¶ÙŠØ± Ù‚Ù‡ÙˆØ© Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ ØºÙ†ÙŠØ© ÙˆÙ…ÙƒØ«ÙØ©.', details: 'Ø­Ø¨ÙˆØ¨ Ù‚Ù‡ÙˆØ© ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ© Ù…Ø­Ù…ØµØ©ØŒ Ù†ÙƒÙ‡Ø© Ù‚ÙˆÙŠØ©.', isFeatured: false },
  { name: 'Ù…Ø§ÙƒØ±ÙˆÙ† Ù…Ù„ÙˆÙ†', category: 'Ø­Ù„ÙˆÙŠØ§Øª', price: 60.00, image: 'https://placehold.co/400x500/F4D7D7/8A3E4E?text=Ù…Ø§ÙƒØ±ÙˆÙ†', description: 'Ù…Ø§ÙƒØ±ÙˆÙ† Ù‡Ø´ ÙˆÙ…Ù„ÙˆÙ† Ø¨Ù†ÙƒÙ‡Ø§Øª Ø§Ù„ÙÙˆØ§ÙƒÙ‡ ÙˆØ§Ù„ÙƒØ±ÙŠÙ…Ø©.', details: 'Ù†ÙƒÙ‡Ø§Øª Ø§Ù„ÙØ±Ø§ÙˆÙ„Ø©ØŒ Ø§Ù„ØªÙˆØªØŒ Ø§Ù„Ù„ÙŠÙ…ÙˆÙ†ØŒ ÙˆØ§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©.', isFeatured: false },
  { name: 'ÙƒÙŠÙƒ Ø§Ù„ÙØ§Ù†ÙŠÙ„ÙŠØ§ ÙˆØ§Ù„ÙØ§ÙƒÙ‡Ø©', category: 'ÙƒÙŠÙƒ', price: 110.00, image: 'https://placehold.co/400x500/D4B8B8/553333?text=ÙƒÙŠÙƒ+ÙØ§Ù†ÙŠÙ„ÙŠØ§', description: 'ÙƒÙŠÙƒ ÙØ§Ù†ÙŠÙ„ÙŠØ§ Ø®ÙÙŠÙ Ù…Ø²ÙŠÙ† Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ø§Ù„Ø·Ø§Ø²Ø¬Ø©.', details: 'ÙƒØ±ÙŠÙ…Ø© ÙØ§Ù†ÙŠÙ„ÙŠØ§ØŒ Ø·Ø¨Ù‚Ø§Øª ÙØ§ÙƒÙ‡Ø©ØŒ Ø®ÙÙŠÙ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø­Ù…ÙŠØ©.', isFeatured: false },
  { name: 'ÙƒÙˆÙƒÙŠØ² Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©', category: 'Ø­Ù„ÙˆÙŠØ§Øª', price: 40.00, image: 'https://placehold.co/400x500/F4D7D7/8A3E4E?text=ÙƒÙˆÙƒÙŠØ²', description: 'ÙƒÙˆÙƒÙŠØ² Ø·Ø±ÙŠ Ù…Ø­Ø´Ùˆ Ø¨Ù‚Ø·Ø¹ Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø§Ù„Ø°Ø§Ø¦Ø¨Ø©.', details: 'Ù‚Ø·Ø¹ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¯Ø§ÙƒÙ†Ø©ØŒ ÙƒÙˆÙƒÙŠØ² Ø¨Ø§Ù„Ø²Ø¨Ø¯Ø©.', isFeatured: false },
  { name: 'Ø¨Ø§Ù‚Ø© Ø²Ù‡ÙˆØ± Ù…ØªÙ†ÙˆØ¹Ø©', category: 'Ø²Ù‡ÙˆØ±', price: 180.00, image: 'https://placehold.co/400x500/F2E4E4/8A3E4E?text=Ø¨Ø§Ù‚Ø©+Ø²Ù‡ÙˆØ±', description: 'ØªÙ†Ø³ÙŠÙ‚ ÙØ±ÙŠØ¯ Ù…Ù† Ø§Ù„Ø²Ù‡ÙˆØ± Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© Ø¨Ø£Ù„ÙˆØ§Ù† Ø²Ø§Ù‡ÙŠØ©.', details: 'Ø²Ù‡ÙˆØ± Ù…ØªÙ†ÙˆØ¹Ø©ØŒ ØªÙ†Ø³ÙŠÙ‚ ÙÙ†ÙŠ.', isFeatured: false },
  { name: 'Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¨ÙŠØ¶Ø§Ø¡ Ø¨Ø§Ù„Ù„ÙˆØ²', category: 'Ø´ÙˆÙƒÙˆÙ„Ø§', price: 90.00, image: 'https://placehold.co/400x500/C4A8A8/553333?text=Ø´ÙˆÙƒÙˆÙ„Ø§+Ø¨ÙŠØ¶Ø§Ø¡', description: 'Ù„ÙˆØ­ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ø§Ø¹Ù…Ø© Ù…Ø¹ Ù‚Ø·Ø¹ Ø§Ù„Ù„ÙˆØ² Ø§Ù„Ù…Ù‚Ø±Ù…Ø´Ø©.', details: 'Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨Ù„Ø¬ÙŠÙƒÙŠØ©ØŒ Ù„ÙˆØ² Ù…Ø­Ù…Øµ.', isFeatured: false },
  { name: 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³ÙŠØ©', category: 'Ù‚Ù‡ÙˆØ©', price: 85.00, image: 'https://placehold.co/400x500/F2EAE4/5C4033?text=Ù‚Ù‡ÙˆØ©+ÙØ±Ù†Ø³ÙŠØ©', description: 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³ÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø§Ù„ØªØ­Ù…ÙŠØµ Ù…Ø¹ Ù†ÙƒÙ‡Ø© Ù‚ÙˆÙŠØ© ÙˆÙ…Ù…ÙŠØ²Ø©.', details: 'ØªØ­Ù…ÙŠØµ Ø¯Ø§ÙƒÙ†ØŒ Ø­Ø¨ÙˆØ¨ Ø£Ø±Ø§Ø¨ÙŠÙƒØ§.', isFeatured: false },
];

const categories = ['Ø§Ù„ÙƒÙ„', 'Ù‚Ù‡ÙˆØ©', 'Ø­Ù„ÙˆÙŠØ§Øª', 'ÙƒÙŠÙƒ', 'Ø²Ù‡ÙˆØ±', 'Ø´ÙˆÙƒÙˆÙ„Ø§'];

// Contexts
const AuthContext = createContext();
const ThemeContext = createContext();
const CartContext = createContext();
const ProductsContext = createContext();
const WishlistContext = createContext();
const ModalContext = createContext();

const useAuth = () => {
  const [user, setUser] = useState(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [authReady, setAuthReady] = useState(false);

  useEffect(() => {
    const signIn = async () => {
      try {
        if (initialAuthToken) {
          await signInWithCustomToken(auth, initialAuthToken);
        } else {
          await signInAnonymously(auth);
        }
      } catch (error) {
        console.error("Firebase Auth error:", error);
      }
    };

    const unsubscribe = onAuthStateChanged(auth, async (authUser) => {
      if (authUser) {
        setUser(authUser);
        // The isAdmin check is now more dynamic and specific
        // We will now also add a check to the AdminPage for the hardcoded values
        setIsAdmin(authUser.email === 'admin@river.com');
      } else {
        setUser(null);
        setIsAdmin(false);
        signIn();
      }
      setAuthReady(true);
    });

    return () => unsubscribe();
  }, []);

  return { user, isAdmin, authReady };
};

const AuthProvider = ({ children }) => {
  const authState = useAuth();
  return <AuthContext.Provider value={authState}>{children}</AuthContext.Provider>;
};

const useProducts = () => {
  const { authReady, user } = useContext(AuthContext);
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);

  // Function to populate initial data if the collection is empty
  const populateInitialData = async (userId) => {
    const collectionRef = collection(db, `artifacts/${appId}/users/${userId}/products`);
    try {
      const querySnapshot = await getDocs(collectionRef);
      if (querySnapshot.empty) {
        for (const product of initialProducts) {
          await addDoc(collectionRef, product);
        }
      }
    } catch (error) {
      console.error("Error populating initial data: ", error);
    }
  };

  useEffect(() => {
    if (!authReady || !user) {
      setLoading(false);
      return;
    }

    const userId = user.uid;

    populateInitialData(userId);

    const q = query(collection(db, `artifacts/${appId}/users/${userId}/products`));
    const unsubscribe = onSnapshot(q, (querySnapshot) => {
      const productsArray = querySnapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data(),
      }));
      setProducts(productsArray);
      setLoading(false);
    }, (error) => {
      console.error("Error fetching products: ", error);
      setLoading(false);
    });

    return () => unsubscribe();
  }, [authReady, user]);

  return { products, loading };
};

const ProductsProvider = ({ children }) => {
  const productsState = useProducts();
  return <ProductsContext.Provider value={productsState}>{children}</ProductsContext.Provider>;
};

const useCart = () => {
  const [cartItems, setCartItems] = useState([]);

  const addToCart = (product, quantity = 1) => {
    setCartItems(prevItems => {
      const existingItem = prevItems.find(item => item.id === product.id);
      if (existingItem) {
        return prevItems.map(item =>
          item.id === product.id ? { ...item, quantity: item.quantity + quantity } : item
        );
      }
      return [...prevItems, { ...product, quantity }];
    });
  };

  const removeFromCart = (productId) => {
    setCartItems(prevItems => prevItems.filter(item => item.id !== productId));
  };

  const updateQuantity = (productId, newQuantity) => {
    setCartItems(prevItems =>
      prevItems.map(item =>
        item.id === productId ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const clearCart = () => setCartItems([]);

  const total = useMemo(() => {
    return cartItems.reduce((acc, item) => acc + item.price * item.quantity, 0);
  }, [cartItems]);

  return { cartItems, addToCart, removeFromCart, updateQuantity, clearCart, total };
};

const CartProvider = ({ children }) => {
  const cart = useCart();
  return <CartContext.Provider value={cart}>{children}</CartContext.Provider>;
};

const useWishlist = () => {
  const { user, authReady } = useContext(AuthContext);
  const [wishlistItems, setWishlistItems] = useState([]);

  useEffect(() => {
    if (authReady && user && user.uid) {
      const q = query(collection(db, `artifacts/${appId}/users/${user.uid}/wishlist`));
      const unsubscribe = onSnapshot(q, (querySnapshot) => {
        const items = querySnapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        setWishlistItems(items);
      }, (error) => {
        console.error("Error fetching wishlist: ", error);
      });
      return () => unsubscribe();
    }
    setWishlistItems([]);
  }, [user, authReady]);

  const addToWishlist = async (product) => {
    if (!user) {
      alert("Please sign in to add to wishlist."); // Using alert for simplicity, but a modal is better.
      return;
    }
    await addDoc(collection(db, `artifacts/${appId}/users/${user.uid}/wishlist`), product);
  };

  const removeFromWishlist = async (itemId) => {
    if (!user) return;
    await deleteDoc(doc(db, `artifacts/${appId}/users/${user.uid}/wishlist`, itemId));
  };

  return { wishlistItems, addToWishlist, removeFromWishlist };
};

const WishlistProvider = ({ children }) => {
  const wishlist = useWishlist();
  return <WishlistContext.Provider value={wishlist}>{children}</WishlistContext.Provider>;
};

const ThemeProvider = ({ children }) => {
  const [isDarkMode, setIsDarkMode] = useState(false);
  const toggleTheme = () => setIsDarkMode(prev => !prev);
  return (
    <ThemeContext.Provider value={{ isDarkMode, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

const useModal = () => {
  const [modalState, setModalState] = useState({
    isOpen: false,
    message: '',
    onConfirm: null,
    onCancel: null,
    type: 'alert' // 'alert' or 'confirm'
  });

  const showModal = (message, type = 'alert', onConfirm = null, onCancel = null) => {
    setModalState({ isOpen: true, message, type, onConfirm, onCancel });
  };

  const closeModal = () => {
    setModalState(prev => ({ ...prev, isOpen: false }));
  };

  return { modalState, showModal, closeModal };
};

const ModalProvider = ({ children }) => {
  const modal = useModal();
  return <ModalContext.Provider value={modal}>{children}</ModalContext.Provider>;
};

const Modal = () => {
  const { modalState, closeModal } = useContext(ModalContext);
  const { isDarkMode } = useContext(ThemeContext);
  const { isOpen, message, type, onConfirm, onCancel } = modalState;

  if (!isOpen) return null;

  const handleConfirm = () => {
    if (onConfirm) onConfirm();
    closeModal();
  };

  const handleCancel = () => {
    if (onCancel) onCancel();
    closeModal();
  };

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-50" style={fontStyles.general}>
      <div className="rounded-2xl shadow-xl transition-colors duration-300 p-8 text-center" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}>
        <h2 className="text-2xl font-bold mb-4">ØªÙ†Ø¨ÙŠÙ‡</h2>
        <p className="text-lg">{message}</p>
        <div className="mt-6 flex justify-center space-x-4 space-x-reverse">
          {type === 'confirm' && (
            <Button onClick={handleCancel} className="bg-gray-500 hover:bg-gray-600 text-white">Ø¥Ù„ØºØ§Ø¡</Button>
          )}
          <Button onClick={handleConfirm} className="bg-orange-500 hover:bg-orange-600 text-white">Ù…ÙˆØ§ÙÙ‚</Button>
        </div>
      </div>
    </div>
  );
};

// Reusable Button
const Button = ({ children, onClick, className = '', type = 'button' }) => (
  <button
    type={type}
    onClick={onClick}
    className={`px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 shadow-md ${className}`}
    style={fontStyles.general}
  >
    {children}
  </button>
);

// Custom Trash Icon
const TrashIcon = (props) => (
  <svg
    {...props}
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
  >
    <polyline points="3 6 5 6 21 6" />
    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
  </svg>
);

// Header component
const Header = ({ onNavigate }) => {
  const { cartItems } = useContext(CartContext);
  const { isDarkMode, toggleTheme } = useContext(ThemeContext);
  const { user, isAdmin } = useContext(AuthContext);

  const getAccountPage = () => {
    if (user && user.email) {
      return 'profile';
    } else {
      return 'account';
    }
  };

  return (
    <header className="sticky top-0 z-50 transition-colors duration-300 shadow-sm" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
      <div className="container mx-auto px-4 py-4 flex items-center justify-between">
        <div className="text-2xl font-bold cursor-pointer transition-colors duration-300" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.river }} onClick={() => onNavigate('home')}>
          RIVER
        </div>
        <nav className="hidden md:flex space-x-6 space-x-reverse font-medium" style={fontStyles.general}>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }} onClick={() => onNavigate('home')}>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }} onClick={() => onNavigate('shop')}>Ø§Ù„Ù…ØªØ¬Ø±</a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }} onClick={() => onNavigate('offers')}>Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }} onClick={() => onNavigate('about')}>Ù…Ù† Ù†Ø­Ù†</a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }} onClick={() => onNavigate('contact')}>Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
          {isAdmin && (
            <a href="#" className="hover:text-amber-500 transition-colors font-bold" style={{ color: isDarkMode ? colors.secondary : colors.primary }} onClick={() => onNavigate('admin')}>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a>
          )}
        </nav>
        <div className="flex items-center space-x-4 space-x-reverse">
          <button onClick={toggleTheme} className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
            {isDarkMode ? <Sun size={24} /> : <Moon size={24} />}
          </button>
          <div className="relative cursor-pointer" onClick={() => onNavigate('wishlist')}>
            <Heart className="hover:text-amber-500 transition-colors" size={24} style={{ color: isDarkMode ? colors.secondary : colors.primary }} />
          </div>
          <div className="relative cursor-pointer" onClick={() => onNavigate('cart')}>
            <ShoppingCart className="hover:text-amber-500 transition-colors" size={24} style={{ color: isDarkMode ? colors.secondary : colors.primary }} />
            {cartItems.length > 0 && (
              <span className="absolute -top-2 -right-2 bg-amber-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
                {cartItems.length}
              </span>
            )}
          </div>
          <div className="cursor-pointer" onClick={() => onNavigate(getAccountPage())}>
            <User className="hover:text-amber-500 transition-colors" size={24} style={{ color: isDarkMode ? colors.secondary : colors.primary }} />
          </div>
        </div>
      </div>
    </header>
  );
};

// Footer component
const Footer = () => {
  const { isDarkMode } = useContext(ThemeContext);
  return (
    <footer className="py-10 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
      <div className="container mx-auto px-4 text-center">
        <div className="flex justify-center space-x-4 space-x-reverse mb-4">
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }}><Instagram size={24} /></a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }}><Facebook size={24} /></a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }}><Twitter size={24} /></a>
          <a href="#" className="hover:text-amber-500 transition-colors" style={{ color: isDarkMode ? colors.secondary : colors.primary }}><Mail size={24} /></a>
        </div>
        <p className="text-sm transition-colors duration-300" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>
          &copy; {new Date().getFullYear()} RIVER. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
        </p>
      </div>
    </footer>
  );
};

// Add to Cart Modal
const AddToCartModal = ({ show, onClose, productName }) => {
  const { isDarkMode } = useContext(ThemeContext);
  if (!show) return null;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" style={fontStyles.general}>
      <div className="rounded-2xl shadow-xl transition-colors duration-300 p-8 text-center" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}>
        <div className="text-5xl text-green-500 mb-4 animate-bounce">ğŸ‰</div>
        <h2 className="text-2xl font-bold mb-2">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©!</h2>
        <p className="text-lg">ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© **{productName}** Ø¥Ù„Ù‰ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ.</p>
        <div className="mt-6 flex justify-center">
          <Button onClick={onClose} className="bg-orange-500 hover:bg-orange-600 text-white">Ø­Ø³Ù†Ø§Ù‹</Button>
        </div>
      </div>
    </div>
  );
};

// Product Card Component
const ProductCard = ({ product, onNavigate }) => {
  const { addToCart } = useContext(CartContext);
  const { addToWishlist } = useContext(WishlistContext);
  const { isDarkMode } = useContext(ThemeContext);
  const [showModal, setShowModal] = useState(false);

  const handleAddToCart = () => {
    addToCart(product);
    setShowModal(true);
  };

  return (
    <div className="rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:scale-105 flex flex-col p-4 text-center" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}>
      <img
        src={product.image}
        alt={product.name}
        className="w-full h-64 object-cover rounded-xl mb-4 cursor-pointer transform hover:scale-105 transition-transform"
        onClick={() => onNavigate('product', product)}
      />
      <div className="relative">
        <button onClick={() => addToWishlist(product)} className="absolute top-2 left-2 text-gray-400 hover:text-red-500 transition-colors">
          <Heart size={24} />
        </button>
      </div>
      <h3 className="text-lg font-semibold mb-2" style={fontStyles.general}>{product.name}</h3>
      <p className="text-xl font-bold text-orange-500 mb-2" style={fontStyles.general}>{product.price.toFixed(2)} Ø±.Ø³</p>
      <Button onClick={handleAddToCart} className="bg-gray-800 hover:bg-gray-900 w-full mt-auto text-white">
        Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
      </Button>
      <AddToCartModal show={showModal} onClose={() => setShowModal(false)} productName={product.name} />
    </div>
  );
};

// Home Page Component
const HomePage = ({ onNavigate }) => {
  const { isDarkMode } = useContext(ThemeContext);
  const { products, loading } = useContext(ProductsContext);

  const featuredProducts = useMemo(() => {
    if (loading) return [];
    return products.slice(0, 4);
  }, [products, loading]);

  return (
    <div className="p-8" style={fontStyles.general}>
      {/* Hero Section */}
      <div className="relative rounded-2xl overflow-hidden mb-12 shadow-lg transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <div className="container mx-auto px-6 py-20 text-center">
          <h1 className="text-5xl md:text-6xl font-extrabold mb-4 animate-fade-in" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.river }}>
            Ø­Ù„Ø§ÙˆØ© Ø§Ù„Ù„Ø­Ø¸Ø©... Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ
          </h1>
          <p className="text-lg md:text-xl mb-8 max-w-2xl mx-auto animate-fade-in-up" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
            Ø§ÙƒØªØ´Ù Ù…Ø¬Ù…ÙˆØ¹ØªÙ†Ø§ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ù‡ÙˆØ© Ø§Ù„ÙØ§Ø®Ø±Ø©ØŒ Ø§Ù„ÙƒÙŠÙƒØŒ Ø§Ù„Ø­Ù„ÙˆÙŠØ§ØªØŒ Ø§Ù„Ø²Ù‡ÙˆØ±ØŒ ÙˆØ§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©.
          </p>
          <Button onClick={() => onNavigate('shop')} className="bg-orange-500 hover:bg-orange-600 text-white">
            Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¢Ù†
          </Button>
        </div>
      </div>

      {/* Featured Products */}
      <div>
        <h2 className="text-3xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>
          Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ø§Ù„Ù…Ù…ÙŠØ²Ø©
        </h2>
        {loading ? (
          <p className="text-center" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {featuredProducts.map(product => (
              <ProductCard key={product.id} product={product} onNavigate={onNavigate} />
            ))}
          </div>
        )}
      </div>
    </div>
  );
};

// Shop Page Component
const ShopPage = ({ onNavigate }) => {
  const { isDarkMode } = useContext(ThemeContext);
  const { products, loading } = useContext(ProductsContext);
  const [selectedCategory, setSelectedCategory] = useState('Ø§Ù„ÙƒÙ„');
  const [searchQuery, setSearchQuery] = useState('');

  const filteredProducts = useMemo(() => {
    return products.filter(p =>
      (selectedCategory === 'Ø§Ù„ÙƒÙ„' || p.category === selectedCategory) &&
      p.name.includes(searchQuery)
    );
  }, [products, selectedCategory, searchQuery]);

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
      <div className="flex flex-col md:flex-row items-center justify-between mb-8 space-y-4 md:space-y-0">
        {/* Search Bar */}
        <div className="relative w-full md:w-1/3">
          <input
            type="text"
            placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
            style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}
          />
          <Search className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400" size={20} />
        </div>
        {/* Categories */}
        <div className="flex justify-center flex-wrap">
          {categories.map(category => (
            <button
              key={category}
              onClick={() => setSelectedCategory(category)}
              className={`px-4 py-2 rounded-full font-medium transition-colors duration-200 m-1 ${
                selectedCategory === category
                  ? 'bg-amber-500 text-white shadow-md'
                  : 'bg-gray-200 text-gray-700 hover:bg-orange-100'
              }`}
            >
              {category}
            </button>
          ))}
        </div>
      </div>
      {loading ? (
        <p className="text-center" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
      ) : (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          {filteredProducts.map(product => (
            <ProductCard key={product.id} product={product} onNavigate={onNavigate} />
          ))}
        </div>
      )}
    </div>
  );
};

// Product Details Page Component
const ProductDetailsPage = ({ product, onNavigate }) => {
  const { addToCart } = useContext(CartContext);
  const { isDarkMode } = useContext(ThemeContext);
  const [quantity, setQuantity] = useState(1);
  const [showModal, setShowModal] = useState(false);

  const handleAddToCart = () => {
    addToCart(product, quantity);
    setShowModal(true);
  };

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <button onClick={() => onNavigate('shop')} className="flex items-center hover:text-orange-500 transition-colors mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
        <ChevronRight size={20} className="ml-2" />
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±
      </button>
      <div className="rounded-2xl shadow-lg overflow-hidden md:flex md:space-x-reverse md:space-x-8 p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <div className="md:w-1/2">
          <img src={product.image} alt={product.name} className="w-full h-auto rounded-xl shadow-lg" />
        </div>
        <div className="md:w-1/2 mt-6 md:mt-0 flex flex-col justify-center">
          <h1 className="text-4xl font-bold mb-4" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>{product.name}</h1>
          <p className="text-lg mb-6" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{product.description}</p>
          <div className="flex items-center mb-6">
            <span className="text-4xl font-bold text-orange-500">{product.price.toFixed(2)} Ø±.Ø³</span>
          </div>
          <div className="flex items-center mb-6 space-x-4 space-x-reverse">
            <label htmlFor="quantity" className="font-semibold" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
            <input
              type="number"
              id="quantity"
              min="1"
              value={quantity}
              onChange={(e) => setQuantity(Math.max(1, parseInt(e.target.value) || 1))}
              className="w-20 px-3 py-2 border rounded-full text-center transition-colors duration-300"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}
            />
          </div>
          <Button onClick={handleAddToCart} className="bg-orange-500 hover:bg-orange-600 w-full md:w-auto text-white">
            Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
          </Button>
        </div>
      </div>
      <AddToCartModal show={showModal} onClose={() => setShowModal(false)} productName={product.name} />
    </div>
  );
};

// Cart Page Component
const CartPage = ({ onNavigate }) => {
  const { cartItems, removeFromCart, updateQuantity, total } = useContext(CartContext);
  const { isDarkMode } = useContext(ThemeContext);

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>
      {cartItems.length === 0 ? (
        <div className="text-center text-xl py-12" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
          Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©. Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†!
        </div>
      ) : (
        <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
          <div className="space-y-6">
            {cartItems.map(item => (
              <div key={item.id} className="flex items-center justify-between border-b pb-4 last:border-b-0 last:pb-0" style={{ borderColor: isDarkMode ? colors.accent : colors.primary }}>
                <div className="flex items-center space-x-4 space-x-reverse">
                  <img src={item.image} alt={item.name} className="w-20 h-20 object-cover rounded-xl" />
                  <div>
                    <h3 className="text-lg font-semibold" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{item.name}</h3>
                    <p className="text-gray-500" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{item.price.toFixed(2)} Ø±.Ø³</p>
                  </div>
                </div>
                <div className="flex items-center space-x-4 space-x-reverse">
                  <input
                    type="number"
                    min="1"
                    value={item.quantity}
                    onChange={(e) => updateQuantity(item.id, parseInt(e.target.value) || 1)}
                    className="w-16 px-2 py-1 text-center border rounded-full transition-colors duration-300"
                    style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}
                  />
                  <button
                    onClick={() => removeFromCart(item.id)}
                    className="text-gray-400 hover:text-red-500 transition-colors"
                  >
                    <X size={20} />
                  </button>
                </div>
              </div>
            ))}
          </div>
          <div className="mt-8 pt-6 border-t" style={{ borderColor: isDarkMode ? colors.accent : colors.primary }}>
            <div className="flex justify-between items-center text-xl font-bold" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
              <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
              <span>{total.toFixed(2)} Ø±.Ø³</span>
            </div>
          </div>
          <div className="mt-8 flex justify-end">
            <Button onClick={() => onNavigate('checkout')} className="bg-orange-500 hover:bg-orange-600 text-white">
              Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

// Checkout Page Component
const CheckoutPage = ({ onNavigate }) => {
  const { isDarkMode } = useContext(ThemeContext);
  const { clearCart } = useContext(CartContext);
  const [isOrderPlaced, setIsOrderPlaced] = useState(false);
  const [address, setAddress] = useState('');
  const { user } = useContext(AuthContext);

  useEffect(() => {
    // Fetch user's saved address if available
    const fetchAddress = async () => {
      if (user && user.uid) {
        const docRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/address`);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          setAddress(docSnap.data().address);
        }
      }
    };
    fetchAddress();
  }, [user]);

  const handlePlaceOrder = () => {
    setIsOrderPlaced(true);
    clearCart();
    setTimeout(() => {
      onNavigate('home');
    }, 3000);
  };

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</h1>
      {isOrderPlaced ? (
        <div className="text-center rounded-2xl shadow-lg p-12 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
          <div className="text-5xl text-green-500 mb-4 animate-bounce">
            ğŸ‰
          </div>
          <h2 className="text-2xl font-bold mb-2" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
          <p style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¶ÙŠØ± Ø·Ù„Ø¨Ùƒ ÙˆØ´Ø­Ù†Ù‡ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†.</p>
        </div>
      ) : (
        <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
          <form className="space-y-6">
            <div>
              <label htmlFor="name" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <input type="text" id="name" className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }} />
            </div>
            <div>
              <label htmlFor="phone" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
              <input type="tel" id="phone" className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ" style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }} />
            </div>
            <div>
              <label htmlFor="address" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
              <textarea id="address" rows="3" value={address} onChange={(e) => setAddress(e.target.value)} className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†" style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}></textarea>
            </div>
            <div className="mt-6">
              <h3 className="text-lg font-semibold mb-4" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</h3>
              <div className="flex items-center space-x-4 space-x-reverse">
                <label className="flex items-center cursor-pointer">
                  <input type="radio" name="payment" value="card" defaultChecked className="form-radio text-amber-500 h-5 w-5" />
                  <span className="ml-2" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†ÙŠØ©</span>
                </label>
                <label className="flex items-center cursor-pointer">
                  <input type="radio" name="payment" value="cod" className="form-radio text-amber-500 h-5 w-5" />
                  <span className="ml-2" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span>
                </label>
              </div>
            </div>
          </form>
          <div className="mt-8 flex justify-end">
            <Button onClick={handlePlaceOrder} className="bg-orange-500 hover:bg-orange-600 text-white">
              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

// About Us Page
const AboutPage = () => {
  const { isDarkMode } = useContext(ThemeContext);
  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ù…Ù† Ù†Ø­Ù†</h1>
      <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <p className="text-lg leading-relaxed" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
         RIVER Ø¨ÙƒÙ„ ÙØ®Ø± Ù‡Ùˆ ÙˆØ¬Ù‡ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„ØªØ³ØªÙ…ØªØ¹ Ø¨ÙƒÙ„ Ù„Ø­Ø¸Ø© Ùˆ ØªØ¬Ø¹Ù„Ù‡Ø§ Ø£Ø®Ù„Ù‰ Ùˆ Ø£Ø­Ù„Ù‰ , Ù†Ù‚Ø¯Ù… Ø£Ø¬ÙˆØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ùˆ Ø£ÙØ®Ø± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù‚Ù‡ÙˆØ© , Ùˆ Ø§Ù„ÙƒÙŠÙƒ Ùˆ Ø§Ù„Ø²Ù‡ÙˆØ± , Ø¥Ø´ØªØ±ÙŠ Ø§Ù„Ø¢Ù† Ùˆ Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø­Ù„Ø§ÙˆØ© Ø§Ù„Ø·Ø¹Ù… .
        </p>
        <p className="mt-4 text-lg leading-relaxed" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
          Ù†Ø­Ù† Ù†Ø¤Ù…Ù† Ø¨Ø£Ù† ÙƒÙ„ Ù…Ù†ØªØ¬ Ù†Ù‚Ø¯Ù…Ù‡ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­Ù…Ù„ Ù‚ØµØ© Ù…Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø´ØºÙ. Ù‡Ø¯ÙÙ†Ø§ Ù‡Ùˆ Ø£Ù† Ù†Ø¬Ø¹Ù„ ÙƒÙ„ Ù„Ø­Ø¸Ø© Ù…Ù† ÙŠÙˆÙ…Ùƒ Ø£ÙƒØ«Ø± Ø­Ù„Ø§ÙˆØ© ÙˆØ¨Ù‡Ø¬Ø©.
        </p>
      </div>
    </div>
  );
};

// Contact Us Page
const ContactPage = () => {
  const { isDarkMode } = useContext(ThemeContext);
  const { showModal } = useContext(ModalContext);
  const [formData, setFormData] = useState({ name: '', email: '', message: '' });

  const web3formsAccessKey = "10b6aec5-d660-4cc4-834a-e740a5a4f554";

  const handleInputChange = (e) => {
    const { id, value } = e.target;
    setFormData(prevState => ({ ...prevState, [id]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    const form = new FormData();
    form.append("access_key", web3formsAccessKey);
    form.append("name", formData.name);
    form.append("email", formData.email);
    form.append("message", formData.message);

    try {
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: form
      });

      const result = await response.json();
      if (result.success) {
        showModal('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§.', 'alert');
        setFormData({ name: '', email: '', message: '' });
      } else {
        showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'alert');
      }
    } catch (error) {
      console.error("Error submitting form:", error);
      showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.', 'alert');
    }
  };

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ø§ØªØµÙ„ Ø¨Ù†Ø§</h1>
      <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <p className="text-lg mb-6" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
          ÙŠØ³Ø¹Ø¯Ù†Ø§ ØªÙˆØ§ØµÙ„Ùƒ Ù…Ø¹Ù†Ø§ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªÙƒ ÙˆØ§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ.
        </p>
        <div className="space-y-4">
          <div className="flex items-center space-x-4 space-x-reverse">
            <Phone size={24} className="text-orange-500" />
            <span className="text-lg" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>+97430176964</span>
          </div>
          <div className="flex items-center space-x-4 space-x-reverse">
            <Mail size={24} className="text-orange-500" />
            <span className="text-lg" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>g06619251@gmail.com</span>
          </div>
        </div>
        <form onSubmit={handleSubmit} className="mt-8 space-y-4">
          <div>
            <label htmlFor="name" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø§Ø³Ù…</label>
            <input
              type="text"
              id="name"
              value={formData.name}
              onChange={handleInputChange}
              className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}
              required
            />
          </div>
          <div>
            <label htmlFor="email" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input
              type="email"
              id="email"
              value={formData.email}
              onChange={handleInputChange}
              className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}
              required
            />
          </div>
          <div>
            <label htmlFor="message" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
            <textarea
              id="message"
              rows="4"
              value={formData.message}
              onChange={handleInputChange}
              className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}
              required
            />
          </div>
          <Button type="submit" className="bg-orange-500 hover:bg-orange-600 text-white w-full">
            Ø¥Ø±Ø³Ø§Ù„
          </Button>
        </form>
      </div>
    </div>
  );
};

// Account Page
const AccountPage = ({ onNavigate }) => {
  const [isLogin, setIsLogin] = useState(true);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const { isDarkMode } = useContext(ThemeContext);

  // -------------------------------------------------------------------------------------------
  // WARNING: FOR DEMONSTRATION PURPOSES ONLY!
  //
  // Storing credentials directly in client-side code is a major security risk.
  // Anyone can view this code and gain admin access.
  // In a real-world application, this check must be done on a secure backend server.
  //
  // ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·!
  //
  // ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù‡Ùˆ Ø®Ø·Ø± Ø£Ù…Ù†ÙŠ ÙƒØ¨ÙŠØ±.
  // ÙŠÙ…ÙƒÙ† Ù„Ø£ÙŠ Ø´Ø®Øµ Ø±Ø¤ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±.
  // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… Ø¢Ù…Ù†.
  // -------------------------------------------------------------------------------------------
  const ADMIN_EMAIL = 'g06619521@gmail.com';
  const ADMIN_PASSWORD = 'omar12345';

  const handleAuth = async (e) => {
    e.preventDefault();
    setError('');

    try {
      if (isLogin) {
        // First, check for hardcoded admin credentials
        if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
          onNavigate('admin');
        } else {
          // If not admin, try regular user login
          await signInWithEmailAndPassword(auth, email, password);
          onNavigate('profile');
        }
      } else {
        // User registration
        await createUserWithEmailAndPassword(auth, email, password);
        onNavigate('profile');
      }
    } catch (e) {
      setError(e.message);
    }
  };

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>
        {isLogin ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨'}
      </h1>
      <div className="max-w-md mx-auto rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <form onSubmit={handleAuth} className="space-y-4">
          <div>
            <label htmlFor="email" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}
              required
            />
          </div>
          <div>
            <label htmlFor="password" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}
              required
            />
          </div>
          {error && <p className="text-red-500 text-sm text-center">{error}</p>}
          <Button type="submit" className="bg-orange-500 hover:bg-orange-600 text-white w-full">
            {isLogin ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨'}
          </Button>
        </form>
        <div className="mt-4 text-center">
          <button onClick={() => setIsLogin(!isLogin)} className="text-sm hover:underline" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
            {isLogin ? 'Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ø­Ø³Ø§Ø¨ØŸ Ø£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ø§Ù‹' : 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„'}
          </button>
        </div>
      </div>
    </div>
  );
};

// Profile Page (New)
const ProfilePage = ({ onNavigate }) => {
  const { isDarkMode } = useContext(ThemeContext);
  const { user } = useContext(AuthContext);
  const [address, setAddress] = useState('');
  const { showModal } = useContext(ModalContext);

  useEffect(() => {
    if (user) {
      const fetchAddress = async () => {
        const docRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/address`);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          setAddress(docSnap.data().address);
        }
      };
      fetchAddress();
    }
  }, [user]);

  const handleSaveAddress = async (e) => {
    e.preventDefault();
    if (user && address) {
      try {
        const docRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/address`);
        await setDoc(docRef, { address });
        showModal('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ù†Ø¬Ø§Ø­!', 'alert');
      } catch (e) {
        showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†.', 'alert');
        console.error("Error saving address: ", e);
      }
    }
  };

  const handleLogout = async () => {
    try {
      await signOut(auth);
      onNavigate('home');
      showModal('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­.');
    } catch (e) {
      showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.');
    }
  };

  if (!user) {
    return (
      <div className="container mx-auto p-8 text-center" style={fontStyles.general}>
        <h1 className="text-4xl font-bold mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ø­Ø³Ø§Ø¨ÙŠ</h1>
        <p style={{ color: isDarkMode ? colors.secondary : colors.primary }}>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù„Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø­Ø³Ø§Ø¨.</p>
      </div>
    );
  }

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ {user.email}!</h1>
      <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300 mb-8" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <h2 className="text-2xl font-bold mb-4" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø«Ø§Ø¨Øª</h2>
        <form onSubmit={handleSaveAddress} className="space-y-4">
          <div>
            <label htmlFor="address" className="block font-medium mb-1" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <textarea
              id="address"
              rows="3"
              value={address}
              onChange={(e) => setAddress(e.target.value)}
              className="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
              placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø«Ø§Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ"
              style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary, borderColor: isDarkMode ? colors.primary : colors.secondary }}
              required
            />
          </div>
          <Button type="submit" className="bg-green-500 hover:bg-green-600 text-white">Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</Button>
        </form>
      </div>
      <div className="flex justify-center">
        <Button onClick={handleLogout} className="bg-red-500 hover:bg-red-600 text-white">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</Button>
      </div>
    </div>
  );
};


// Offers and Gifts Page (New)
const OffersPage = () => {
  const { isDarkMode } = useContext(ThemeContext);

  const offers = [
    { id: 1, title: 'Ø®ØµÙ… 20% Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù‡ÙˆØ©', description: 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… 20% Ø¹Ù†Ø¯ Ø´Ø±Ø§Ø¡ Ø£ÙŠ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù‚Ù‡ÙˆØ© Ø§Ù„ÙØ§Ø®Ø±Ø©.', image: 'https://placehold.co/600x400/F2EAE4/5C4033?text=Ø¹Ø±Ø¶+Ø§Ù„Ù‚Ù‡ÙˆØ©' },
    { id: 2, title: 'Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ù…Ø¬Ø§Ù†ÙŠØ©', description: 'Ø§Ø´ØªØ±Ù Ø£ÙŠ ÙƒÙŠÙƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ù„Ø¨Ø© Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨Ù„Ø¬ÙŠÙƒÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©.', image: 'https://placehold.co/600x400/D4B8B8/553333?text=Ù‡Ø¯ÙŠØ©+Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©' },
    { id: 3, title: 'ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ', description: 'ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ ØªØ²ÙŠØ¯ Ù‚ÙŠÙ…ØªÙ‡Ø§ Ø¹Ù† 200 Ø±.Ø³.', image: 'https://placehold.co/600x400/A5776B/E8E2D9?text=ØªÙˆØµÙŠÙ„+Ù…Ø¬Ø§Ù†ÙŠ' },
  ];

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</h1>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {offers.map(offer => (
          <div key={offer.id} className="rounded-2xl shadow-lg overflow-hidden transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
            <img src={offer.image} alt={offer.title} className="w-full h-48 object-cover" />
            <div className="p-6">
              <h2 className="text-2xl font-bold mb-2" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{offer.title}</h2>
              <p style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{offer.description}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// Edit Product Modal Component (NEW)
const EditProductModal = ({ product, onClose, onUpdate }) => {
  const [name, setName] = useState(product.name);
  const [category, setCategory] = useState(product.category);
  const [price, setPrice] = useState(product.price);
  const [image, setImage] = useState(product.image);
  const [description, setDescription] = useState(product.description);
  const [details, setDetails] = useState(product.details);
  const [isFeatured, setIsFeatured] = useState(product.isFeatured);
  const { isDarkMode } = useContext(ThemeContext);

  const handleSubmit = (e) => {
    e.preventDefault();
    onUpdate(product.id, {
      name,
      category,
      price: parseFloat(price),
      image,
      description,
      details,
      isFeatured,
    });
  };

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-50" style={fontStyles.general}>
      <div className="rounded-2xl shadow-xl transition-colors duration-300 p-8 w-full max-w-lg" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}>
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
          <button onClick={onClose} className="hover:text-red-500 transition-colors">
            <X size={24} />
          </button>
        </div>
        <form onSubmit={handleSubmit} className="space-y-4">
          <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" value={name} onChange={(e) => setName(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <input type="text" placeholder="Ø§Ù„ÙØ¦Ø©" value={category} onChange={(e) => setCategory(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <input type="number" step="0.01" placeholder="Ø§Ù„Ø³Ø¹Ø±" value={price} onChange={(e) => setPrice(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <input type="text" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" value={image} onChange={(e) => setImage(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <textarea placeholder="Ø§Ù„ÙˆØµÙ" value={description} onChange={(e) => setDescription(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required></textarea>
          <textarea placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„" value={details} onChange={(e) => setDetails(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required></textarea>
          <div className="flex items-center">
            <input type="checkbox" id="isFeatured" checked={isFeatured} onChange={(e) => setIsFeatured(e.target.checked)} className="h-4 w-4 text-orange-500 rounded" />
            <label htmlFor="isFeatured" className="ml-2">Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ²</label>
          </div>
          <div className="flex justify-end space-x-2 space-x-reverse">
            <Button type="button" onClick={onClose} className="bg-gray-500 hover:bg-gray-600 text-white">Ø¥Ù„ØºØ§Ø¡</Button>
            <Button type="submit" className="bg-orange-500 hover:bg-orange-600 text-white">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</Button>
          </div>
        </form>
      </div>
    </div>
  );
};


// Admin Page
const AdminPage = () => {
  const [productName, setProductName] = useState('');
  const [productCategory, setProductCategory] = useState('');
  const [productPrice, setProductPrice] = useState('');
  const [productImage, setProductImage] = useState('');
  const [productDescription, setProductDescription] = useState('');
  const [productDetails, setProductDetails] = useState('');
  const [isFeatured, setIsFeatured] = useState(false);
  const [editingProduct, setEditingProduct] = useState(null); // New state for editing
  
  const { isDarkMode } = useContext(ThemeContext);
  const { products } = useContext(ProductsContext);
  const { showModal } = useContext(ModalContext);
  const { user } = useContext(AuthContext);

  const handleAddProduct = async (e) => {
    e.preventDefault();
    if (!user) {
      showModal('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.');
      return;
    }
    try {
      // Now adds product to the user's private collection
      await addDoc(collection(db, `artifacts/${appId}/users/${user.uid}/products`), {
        name: productName,
        category: productCategory,
        price: parseFloat(productPrice),
        image: productImage,
        description: productDescription,
        details: productDetails,
        isFeatured: isFeatured,
      });
      showModal('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
      // Clear form
      setProductName('');
      setProductCategory('');
      setProductPrice('');
      setProductImage('');
      setProductDescription('');
      setProductDetails('');
      setIsFeatured(false);
    } catch (e) {
      console.error("Error adding product: ", e);
      showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬.');
    }
  };

  const handleUpdateProduct = async (id, updatedData) => {
    if (!user) {
      showModal('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.');
      return;
    }
    try {
      await updateDoc(doc(db, `artifacts/${appId}/users/${user.uid}/products`, id), updatedData);
      showModal('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
      setEditingProduct(null); // Close the modal
    } catch (e) {
      console.error("Error updating product: ", e);
      showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬.');
    }
  };

  const handleDeleteProduct = (id) => {
    showModal('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ', 'confirm', async () => {
      if (!user) {
        showModal('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± Ù„Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.');
        return;
      }
      try {
        // Now deletes product from the user's private collection
        await deleteDoc(doc(db, `artifacts/${appId}/users/${user.uid}/products`, id));
        showModal('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.');
      } catch (e) {
        console.error("Error deleting product: ", e);
        showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬.');
      }
    });
  };

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
      <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
        <h2 className="text-2xl font-bold mb-4" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
        <form onSubmit={handleAddProduct} className="space-y-4">
          <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" value={productName} onChange={(e) => setProductName(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <input type="text" placeholder="Ø§Ù„ÙØ¦Ø©" value={productCategory} onChange={(e) => setProductCategory(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <input type="number" step="0.01" placeholder="Ø§Ù„Ø³Ø¹Ø±" value={productPrice} onChange={(e) => setProductPrice(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <input type="text" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" value={productImage} onChange={(e) => setProductImage(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required />
          <textarea placeholder="Ø§Ù„ÙˆØµÙ" value={productDescription} onChange={(e) => setProductDescription(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required></textarea>
          <textarea placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„" value={productDetails} onChange={(e) => setProductDetails(e.target.value)} className="w-full px-4 py-2 border rounded-xl" required></textarea>
          <div className="flex items-center">
            <input type="checkbox" id="isFeatured" checked={isFeatured} onChange={(e) => setIsFeatured(e.target.checked)} className="h-4 w-4 text-orange-500 rounded" />
            <label htmlFor="isFeatured" className="ml-2" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ²</label>
          </div>
          <Button type="submit" className="bg-green-500 hover:bg-green-600 text-white w-full">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</Button>
        </form>

        <h2 className="text-2xl font-bold mt-8 mb-4" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
        <div className="space-y-4">
          {products.map(product => (
            <div key={product.id} className="flex items-center justify-between rounded-xl p-4 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}>
              <span>{product.name} - {product.price.toFixed(2)} Ø±.Ø³</span>
              <div className="flex items-center space-x-2 space-x-reverse">
                <button onClick={() => setEditingProduct(product)} className="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors duration-200">
                  <Pencil size={20} />
                </button>
                <button onClick={() => handleDeleteProduct(product.id)} className="bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors duration-200">
                  <TrashIcon />
                </button>
              </div>
            </div>
          ))}
        </div>
      </div>
      {editingProduct && (
        <EditProductModal
          product={editingProduct}
          onClose={() => setEditingProduct(null)}
          onUpdate={handleUpdateProduct}
        />
      )}
    </div>
  );
};

// Wishlist Page
const WishlistPage = () => {
  const { user } = useContext(AuthContext);
  const { wishlistItems, removeFromWishlist } = useContext(WishlistContext);
  const { isDarkMode } = useContext(ThemeContext);

  if (!user || !user.email) {
    return (
      <div className="container mx-auto p-8 text-center" style={fontStyles.general}>
        <h1 className="text-4xl font-bold mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª</h1>
        <p style={{ color: isDarkMode ? colors.secondary : colors.primary }}>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª.</p>
      </div>
    );
  }

  return (
    <div className="container mx-auto p-8" style={fontStyles.general}>
      <h1 className="text-4xl font-bold text-center mb-8" style={{ color: isDarkMode ? colors.secondary : colors.primary, ...fontStyles.general }}>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª</h1>
      {wishlistItems.length === 0 ? (
        <div className="text-center text-xl py-12" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
          Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª ÙØ§Ø±ØºØ©.
        </div>
      ) : (
        <div className="rounded-2xl shadow-lg p-6 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
          <div className="space-y-6">
            {wishlistItems.map(item => (
              <div key={item.id} className="flex items-center justify-between border-b pb-4 last:border-b-0 last:pb-0" style={{ borderColor: isDarkMode ? colors.accent : colors.primary }}>
                <div className="flex items-center space-x-4 space-x-reverse">
                  <img src={item.image} alt={item.name} className="w-20 h-20 object-cover rounded-xl" />
                  <div>
                    <h3 className="text-lg font-semibold" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{item.name}</h3>
                    <p style={{ color: isDarkMode ? colors.secondary : colors.primary }}>{item.price.toFixed(2)} Ø±.Ø³</p>
                  </div>
                </div>
                <button
                  onClick={() => removeFromWishlist(item.id)}
                  className="bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors duration-200"
                >
                  <TrashIcon />
                </button>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

// AI Chatbot Component
const Chatbot = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([{
    sender: 'bot',
    text: 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ! Ø£Ù†Ø§ ÙˆØ¯ÙˆØ¯ØŒ Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„ÙÙƒØ§Ù‡ÙŠ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ÙˆØ§Ù„Ù‚Ù‡ÙˆØ©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ù† Ø£Ø¬Ø¹Ù„ ÙŠÙˆÙ…Ùƒ Ø£Ø­Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ…ØŸ'
  }]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const chatEndRef = useRef(null);

  const chatbotAvatar = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>';
  const chocolateAvatar = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><linearGradient id="chocolateGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#4A2C2A;stop-opacity:1" /><stop offset="100%" style="stop-color:#785A48;stop-opacity:1" /></linearGradient></defs><path fill="url(#chocolateGradient)" d="M50,90 C30,90 15,75 15,55 C15,35 30,20 50,20 C70,20 85,35 85,55 C85,75 70,90 50,90 Z" /><path fill="#E8E2D9" d="M30,55 Q40,65 50,55 T70,55 A5,5 0 0 1 70,60 H30 A5,5 0 0 1 30,55 Z" /><circle cx="40" cy="45" r="5" fill="#E8E2D9" /><circle cx="60" cy="45" r="5" fill="#E8E2D9" /><path fill="none" stroke="#E8E2D9" stroke-width="3" d="M35,65 Q50,80 65,65" /></svg>';

  const handleSendMessage = async () => {
    if (!input.trim() || isLoading) return;
    const userMessage = { sender: 'user', text: input };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsLoading(true);

    const botResponse = await getChatbotResponse(userMessage.text);
    setMessages(prev => [...prev, { sender: 'bot', text: botResponse }]);
    setIsLoading(false);
  };

  const getChatbotResponse = async (userPrompt) => {
    const prompt = `You are an AI assistant named "ÙˆØ¯ÙˆØ¯" (Wadoud) for an e-commerce store named RIVER. Your persona is funny, encouraging, and an excellent product marketer. Your goal is to help customers, promote products, and be charming. The store sells coffee, sweets, cakes, flowers, and chocolates. If a user asks a question you cannot answer, or is outside of your scope, say: "Ø¹ÙÙˆØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§ Ù„ÙŠØ³Øª Ù„Ø¯ÙŠØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø£Ùˆ Ø§Ù„Ù…ØªØ¬Ø±".
    
    Products available:
    - Ù…Ø¬Ù…ÙˆØ¹Ø© Ù‚Ù‡ÙˆØ© ÙØ§Ø®Ø±Ø©: Ø£ÙØ®Ø± Ø£Ù†ÙˆØ§Ø¹ Ø­Ø¨ÙˆØ¨ Ø§Ù„Ø¨Ù† Ù…Ù† Ù…Ø²Ø§Ø±Ø¹ Ù…Ø®ØªØ§Ø±Ø©.
    - ØªØ´ÙƒÙŠÙ„Ø© Ø­Ù„ÙˆÙŠØ§Øª Ù…Ù†ÙˆØ¹Ø©: Ù…Ø§ÙƒØ±ÙˆÙ†ØŒ ÙƒÙˆÙƒÙŠØ²ØŒ ÙˆÙƒØ¨ ÙƒÙŠÙƒ.
    - ÙƒÙŠÙƒ Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø§Ù„ØºÙ†ÙŠ: ÙƒÙŠÙƒ Ø³Ø§Ø­Ø± ÙŠØ°ÙˆØ¨ ÙÙŠ Ø§Ù„ÙÙ….
    - Ø¨Ø§Ù‚Ø© ÙˆØ±ÙˆØ¯ Ø£Ù†ÙŠÙ‚Ø©: Ù‡Ø¯ÙŠØ© Ù…Ø«Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØ±ÙˆØ¯ Ø§Ù„Ø·Ø§Ø²Ø¬Ø©.
    - Ø¹Ù„Ø¨Ø© Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¨Ù„Ø¬ÙŠÙƒÙŠØ©: Ø´ÙˆÙƒÙˆÙ„Ø§ ÙØ§Ø®Ø±Ø© Ø¨Ù†ÙƒÙ‡Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©.
    - Ù‚Ù‡ÙˆØ© Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ Ø®Ø§ØµØ©: Ù‚Ù‡ÙˆØ© ØºÙ†ÙŠØ© ÙˆÙ…ÙƒØ«ÙØ©.
    - Ù…Ø§ÙƒØ±ÙˆÙ† Ù…Ù„ÙˆÙ†: Ù…Ø§ÙƒØ±ÙˆÙ† Ù‡Ø´ ÙˆÙ…Ù„ÙˆÙ†.
    - ÙƒÙŠÙƒ Ø§Ù„ÙØ§Ù†ÙŠÙ„ÙŠØ§ ÙˆØ§Ù„ÙØ§ÙƒÙ‡Ø©: ÙƒÙŠÙƒ Ø®ÙÙŠÙ Ù…Ø²ÙŠÙ† Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡.
    - ÙƒÙˆÙƒÙŠØ² Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©: ÙƒÙˆÙƒÙŠØ² Ø·Ø±ÙŠ Ù…Ø­Ø´Ùˆ Ø¨Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©.
    - Ø¨Ø§Ù‚Ø© Ø²Ù‡ÙˆØ± Ù…ØªÙ†ÙˆØ¹Ø©: ØªÙ†Ø³ÙŠÙ‚ ÙØ±ÙŠØ¯ Ù…Ù† Ø§Ù„Ø²Ù‡ÙˆØ±.
    - Ø´ÙˆÙƒÙˆÙ„Ø§ Ø¨ÙŠØ¶Ø§Ø¡ Ø¨Ø§Ù„Ù„ÙˆØ²: Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ø¹ Ù„ÙˆØ².
    - Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³ÙŠØ©: Ù‚Ù‡ÙˆØ© Ø¯Ø§ÙƒÙ†Ø© Ø§Ù„ØªØ­Ù…ÙŠØµ.
    
    User query: ${userPrompt}
    
    Your response, as Wadoud, must be in Arabic.`;

    try {
      const payload = {
        contents: [{ role: "user", parts: [{ text: prompt }] }],
      };
      // The API key is managed by the execution environment
      const apiKey = "";
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
      return text || 'Ø¹ÙÙˆØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§ Ù„ÙŠØ³Øª Ù„Ø¯ÙŠØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø£Ùˆ Ø§Ù„Ù…ØªØ¬Ø±';
    } catch (e) {
      console.error("AI API call failed: ", e);
      return 'Ø¹ÙÙˆØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§ Ù„ÙŠØ³Øª Ù„Ø¯ÙŠØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø£Ùˆ Ø§Ù„Ù…ØªØ¬Ø±';
    }
  };

  useEffect(() => {
    if (chatEndRef.current) {
      chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages]);

  const { isDarkMode } = useContext(ThemeContext);

  return (
    <>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="fixed bottom-6 right-6 z-50 p-4 rounded-full shadow-lg transition-transform transform hover:scale-110"
        style={{ backgroundColor: colors.primary, color: colors.secondary }}
      >
        <MessageSquare size={24} />
      </button>

      {isOpen && (
        <div className="fixed bottom-20 right-6 w-80 h-96 bg-white rounded-2xl shadow-xl flex flex-col z-50 transition-colors duration-300" style={{ backgroundColor: isDarkMode ? colors.primary : colors.secondary }}>
          <div className="flex items-center justify-between p-4 border-b rounded-t-2xl" style={{ borderColor: isDarkMode ? colors.accent : colors.primary }}>
            <div className="flex items-center space-x-2 space-x-reverse">
              <div className="w-8 h-8 rounded-full" style={{ backgroundImage: `url(${chocolateAvatar})`, backgroundSize: 'cover' }} />
              <span className="font-bold" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>ÙˆØ¯ÙˆØ¯</span>
            </div>
            <button onClick={() => setIsOpen(false)} style={{ color: isDarkMode ? colors.secondary : colors.primary }}><X size={20} /></button>
          </div>

          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {messages.map((msg, index) => (
              <div key={index} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div
                  className={`p-3 rounded-xl max-w-[75%] ${
                    msg.sender === 'user' ? 'bg-orange-500 text-white' : 'bg-gray-200 text-gray-800'
                  }`}
                  style={{ backgroundColor: msg.sender === 'user' ? '#f97316' : (isDarkMode ? colors.accent : '#F3F4F6'), color: msg.sender === 'user' ? '#ffffff' : (isDarkMode ? colors.secondary : '#111827') }}
                >
                  {msg.text}
                </div>
              </div>
            ))}
            {isLoading && (
                <div className="flex justify-start">
                    <div className="p-3 rounded-xl max-w-[75%]" style={{ backgroundColor: isDarkMode ? colors.accent : '#F3F4F6', color: isDarkMode ? colors.secondary : '#111827' }}>
                        ...
                    </div>
                </div>
            )}
            <div ref={chatEndRef} />
          </div>

          <div className="p-4 border-t rounded-b-2xl" style={{ borderColor: isDarkMode ? colors.accent : colors.primary }}>
            <form onSubmit={(e) => { e.preventDefault(); handleSendMessage(); }} className="flex space-x-2 space-x-reverse">
              <input
                type="text"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                className="flex-1 px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors duration-300"
                placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..."
                disabled={isLoading}
                style={{ backgroundColor: isDarkMode ? colors.accent : colors.secondary, color: isDarkMode ? colors.secondary : colors.primary }}
              />
              <button type="submit" className="bg-orange-500 text-white p-2 rounded-full hover:bg-orange-600 transition-colors duration-200" disabled={isLoading}>
                <ChevronRight size={24} />
              </button>
            </form>
          </div>
        </div>
      )}
    </>
  );
};

// Main App Component
export default function App() {
  const [currentPage, setCurrentPage] = useState('home');
  const [selectedProduct, setSelectedProduct] = useState(null);

  const handleNavigate = (page, product = null) => {
    setCurrentPage(page);
    setSelectedProduct(product);
  };

  const renderPage = () => {
    switch (currentPage) {
      case 'home':
        return <HomePage onNavigate={handleNavigate} />;
      case 'shop':
        return <ShopPage onNavigate={handleNavigate} />;
      case 'product':
        return <ProductDetailsPage product={selectedProduct} onNavigate={handleNavigate} />;
      case 'cart':
        return <CartPage onNavigate={handleNavigate} />;
      case 'checkout':
        return <CheckoutPage onNavigate={handleNavigate} />;
      case 'about':
        return <AboutPage />;
      case 'contact':
        return <ContactPage />;
      case 'account':
        return <AccountPage onNavigate={handleNavigate} />;
      case 'profile':
        return <ProfilePage onNavigate={handleNavigate} />;
      case 'wishlist':
        return <WishlistPage />;
      case 'admin':
        return <AdminPage />;
      case 'offers':
        return <OffersPage />;
      default:
        return <HomePage onNavigate={handleNavigate} />;
    }
  };

  return (
    <ThemeProvider>
      <AuthProvider>
        <ProductsProvider>
          <WishlistProvider>
            <CartProvider>
              <ModalProvider>
                <AppContent onNavigate={handleNavigate} renderPage={renderPage} />
              </ModalProvider>
            </CartProvider>
          </WishlistProvider>
        </ProductsProvider>
      </AuthProvider>
    </ThemeProvider>
  );
}

const AppContent = ({ onNavigate, renderPage }) => {
  const { isDarkMode } = useContext(ThemeContext);
  const { authReady, isAdmin, user } = useContext(AuthContext);

  useEffect(() => {
    document.body.style.backgroundColor = isDarkMode ? '#111827' : '#F9FAFB';
  }, [isDarkMode]);

  return (
    <div className={`min-h-screen text-right transition-colors duration-300`} dir="rtl" style={{ color: isDarkMode ? colors.secondary : colors.primary }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&family=Cormorant+Garamond:wght@400;700&display=swap');
        .animate-fade-in { animation: fadeIn 1s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 1s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        button:focus, input:focus, textarea:focus { outline: none; }
      `}</style>
      <Header onNavigate={onNavigate} />
      <main className="pb-16">
        {renderPage()}
      </main>
      <Footer />
      {authReady && <Chatbot />}
      <Modal />
    </div>
  );
};
